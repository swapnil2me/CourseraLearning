<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <!-- Import TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <!-- Import tfjs-vis -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js"></script>

    <script lang="js">
      async function run(){
        const csvUrl = 'iris.csv';
        const trainingData = await tf.data.csv(csvUrl, {
          columnConfigs: {
            species: {
              isLabel: true
            }
          }
        });

        const numOfFeatures = (await trainingData.columnNames()).length - 1;
        const numOfSamples = 150;


        const convertedData =
          await trainingData.map(({xs,ys}) => {
            const labels = [
              ys.species == "Iris-setosa"?1:0,
              ys.species == "Iris-virginica"?1:0,
              ys.species == "Iris-versicolor"?1:0]

            return {xs: Object.values(xs),ys: Object.values(labels)};
          }).batch(10);

        console.log(await trainingData);
        console.log(await convertedData);

        const model = tf.sequential();

        model.add(tf.layers.dense({
              imputShape: [numOfFeatures],
              activation: "sigmoid",
              units:5}));

        model.add(tf.layers.dense({activation:"softmax",units:3}));

        model.compile({
          loss:"categoricalCrossentropy",
          optimizer: tf.train.adam(0.06)});

        await model.fitDataset(
        convertedData,
        {
          epochs:100,
          callbacks:{
            onEpochEnd: async(epoch, logs) => {
              console.log("E: "+epoch+" Loss:"+logs.loss);}
          }
        });

        const testVal = tf.tensor2d([5.8, 2.7, 5.1, 1.9],[1,4]);
        const prediction = model.predict(testVal);
        alert(prediction);
      }
      run();
    </script>
  </head>
  <body>

  </body>
</html>
